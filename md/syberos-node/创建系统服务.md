## duiy创建系统服务

- .spec 文件

  1. 设置.wants文件的链接（%install）

     ```
     mkdir -p %{buildroot}/%{_lib}/systemd/system/multi-user.target.wants
     ln -s ../SOSService.service %{buildroot}/%{_lib}/systemd/system/multi-user.target.wants/SOSServiec.service
     
     mkdir -p $RPM_BUILD_ROOT/lib/systemd/system/multi-user.target.wants
     ln -s ../servicemanager.service $RPM_BUILD_ROOT/lib/systemd/system/multi-user.target.wants/servicemanager.service
     ```

  2. %file 

     - 权限选择system不要使用root

       ```
       %defattr(-,system,system,-)
       ```

     - 将需要安装的所有依赖都要罗列出来

       - 可执行程序路径 /usr/bin/
       - .service路径 /lib/systemd/system/
       - .so路径 /usr/lib/

     - 安装.wants

       ```
       /lib/systemd/system/multi-user.target.wants/SOSServiec.service
       ```

  3. 检查

     ```
     [root@localhost /]# ll /lib/systemd/system/multi-user.target.wants/
     lrwxrwxrwx 1 system  system  21 2020-07-07 10:01 SOSServiec.service -> ../SOSService.service
     ```

- .service 文件

  ```
  [Unit]
  Description=SOSService
  After=system-main.service

  [Service]
  Type=simple
  ExecStart=/usr/bin/SOSService
  Restart=always
  
  [Install]
  WantedBy=multi-user.target
  ```
  
  

